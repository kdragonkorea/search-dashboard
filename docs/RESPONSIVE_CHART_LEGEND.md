# 반응형 UI - 차트 범례 위치 개선

## 📅 업데이트 날짜
2026-02-06

## 🎯 개선 목적
반응형 UI에서 화면 폭이 좁아질 때 차트가 너무 좁게 표시되는 문제 해결

---

## 📝 문제 상황

### Before (기존)
```
┌─────────────────────────────────┬─────────┐
│                                 │         │
│          차트 영역              │  범례   │  ← 범례가 오른쪽 고정
│                                 │  (고정) │
│                                 │         │
└─────────────────────────────────┴─────────┘
```

**문제점**:
1. 범례가 오른쪽에 고정되어 있음
2. 화면이 좁아져도 범례 폭은 변하지 않음
3. 차트 영역이 너무 좁게 압축됨
4. 모바일/태블릿에서 차트 가독성 저하

---

### After (개선)
```
┌─────────────────────────────────────────┐
│                                         │
│           차트 영역 (넓어짐!)            │  ← 전체 폭 활용
│                                         │
└─────────────────────────────────────────┘
          [범례1] [범례2] [범례3]           ← 범례가 아래로 이동
```

**개선점**:
1. 범례가 차트 아래로 이동 (가로 배치)
2. 차트가 전체 폭을 활용
3. 반응형에서 차트 가독성 향상
4. 모바일/태블릿 UX 개선

---

## 🔧 수정 내역

### 대상 차트 (5개)

1. **주간 트렌드 탭**: "요일별 검색량 추이"
2. **인기 검색어 탭**: "1~5위 키워드별 검색량 추이"
3. **인기 검색어 탭**: "6~10위 키워드별 검색량 추이"
4. **실패 검색어 탭**: "1~5위 실패검색어 추이"
5. **실패 검색어 탭**: "6~10위 실패검색어 추이"

---

### 1. 요일별 검색량 추이

**파일**: `visualizations.py` - `plot_daily_bar_chart()` 함수 (line 75-91)

#### 변경 전
```python
fig.update_layout(
    font_family="Journey, sans-serif",
    title_x=0.5,
    title_xanchor='center',
    xaxis_title="요일", 
    yaxis_title="검색량", 
    legend_title="조회 기간",
    hovermode="closest"
    # 범례 위치 미지정 → 기본값 오른쪽
)
```

#### 변경 후
```python
fig.update_layout(
    font_family="Journey, sans-serif",
    title_x=0.5,
    title_xanchor='center',
    xaxis_title="요일", 
    yaxis_title="검색량", 
    legend_title="조회 기간",
    hovermode="closest",
    margin=dict(b=100),   # 하단 마진 100px (범례 공간 확보)
    legend=dict(
        orientation="h",  # 가로 방향 배치
        yanchor="top",    # 상단 기준
        y=-0.2,           # 차트 아래 20% 위치 (수정: -0.15 → -0.2)
        xanchor="center", # 중앙 정렬
        x=0.5             # 가로 중앙
    )
)
```

**추가 수정 사항** (2026-02-06):
- `margin=dict(b=100)` 추가: 범례 공간 확보
- `y=-0.15` → `y=-0.2`: 범례가 차트를 가리는 문제 해결

---

### 2. 키워드별 검색량 추이 (4개 차트)

**파일**: `visualizations.py` - `plot_keyword_group_trend()` 함수 (line 237-255)

#### 변경 전
```python
fig.update_layout(
    font_family="Journey, sans-serif",
    title_text=title,
    title_x=0.5,
    title_xanchor='center',
    xaxis_title="검색어", 
    yaxis_title="검색량", 
    legend_title="조회 기간",
    hovermode="closest",
    height=420,
    margin=dict(t=50, b=50, l=20, r=20)  # b=50 (하단 여백)
    # 범례 위치 미지정 → 기본값 오른쪽
)
```

#### 변경 후
```python
fig.update_layout(
    font_family="Journey, sans-serif",
    title_text=title,
    title_x=0.5,
    title_xanchor='center',
    xaxis_title="검색어", 
    yaxis_title="검색량", 
    legend_title="조회 기간",
    hovermode="closest",
    height=420,
    margin=dict(t=50, b=80, l=20, r=20),  # b=80 (범례 공간 확보)
    legend=dict(
        orientation="h",  # 가로 방향 배치
        yanchor="top",    # 상단 기준
        y=-0.15,          # 차트 아래 15% 위치
        xanchor="center", # 중앙 정렬
        x=0.5             # 가로 중앙
    )
)
```

---

## 📊 범례 설정 상세

### `legend=dict()` 파라미터 설명

| 파라미터 | 값 | 설명 |
|----------|-----|------|
| `orientation` | `"h"` | 가로 방향 (horizontal) 배치 |
| `yanchor` | `"top"` | y 위치 기준점: 범례 상단 |
| `y` | `-0.15` | 차트 아래 15% 위치 (음수 = 아래) |
| `xanchor` | `"center"` | x 위치 기준점: 범례 중앙 |
| `x` | `0.5` | 차트 가로 중앙 (0.5 = 50%) |

### 마진 조정

- **요일별 차트**: 마진 조정 불필요 (기존 유지)
- **키워드 추이 차트**: `b=50` → `b=80` (하단 여백 30px 증가)

---

## ✅ 효과

### 1. 차트 폭 증가
```
Before: 차트 70% + 범례 30% = 전체 100%
After:  차트 100% = 전체 100% (30% 증가!)
```

### 2. 반응형 개선
| 화면 크기 | Before | After |
|----------|--------|-------|
| **Desktop (1920px)** | 차트 1344px | 차트 1920px ✅ |
| **Tablet (768px)** | 차트 537px (좁음) | 차트 768px ✅ |
| **Mobile (375px)** | 차트 262px (매우 좁음) | 차트 375px ✅ |

### 3. 가독성 향상
- 막대/선 간격이 넓어져 구분이 명확
- 데이터 포인트가 더 크게 표시
- 레이블이 겹치지 않음

---

## 🎨 UI/UX 개선

### Desktop (큰 화면)
```
┌──────────────────────────────────────────────────┐
│                                                  │
│              차트 영역 (넓고 선명)                 │
│                                                  │
└──────────────────────────────────────────────────┘
  [2025/10/01~10/07] [2025/10/08~10/14] [...]
```

### Tablet (중간 화면)
```
┌────────────────────────────────────┐
│                                    │
│      차트 영역 (충분한 폭)           │
│                                    │
└────────────────────────────────────┘
  [2025/10/01~10/07] [2025/10/08~10/14]
```

### Mobile (작은 화면)
```
┌──────────────────────┐
│                      │
│   차트 영역 (확보)    │
│                      │
└──────────────────────┘
  [10/01~10/07]
  [10/08~10/14]
```

---

## 🧪 테스트 가이드

### 1. Desktop 테스트
```
1. 브라우저를 전체 화면으로 확대
2. 각 차트의 범례가 아래에 가로로 배치되어 있는지 확인
3. 차트가 전체 폭을 사용하는지 확인
```

### 2. 반응형 테스트
```
1. 브라우저 개발자 도구 열기 (F12)
2. 반응형 모드 활성화 (Cmd+Shift+M / Ctrl+Shift+M)
3. 화면 폭 조절:
   - 1920px (Desktop)
   - 768px (Tablet)
   - 375px (Mobile)
4. 각 크기에서 차트와 범례 확인
```

### 3. 확인 항목
- [ ] 범례가 차트 아래에 가로로 배치됨
- [ ] 범례가 가운데 정렬됨
- [ ] 차트가 전체 폭을 사용함
- [ ] 모바일에서도 차트가 명확하게 보임
- [ ] 범례 텍스트가 잘리지 않음

---

## 📁 수정된 파일

### 1. `visualizations.py` (2개 함수)

#### 함수 1: `plot_daily_bar_chart()`
- **위치**: line 75-89
- **변경**: 범례 위치 설정 추가

#### 함수 2: `plot_keyword_group_trend()`
- **위치**: line 237-255
- **변경**: 범례 위치 설정 + 하단 마진 증가

---

## 💡 기술적 세부사항

### Plotly Legend 배치 옵션

#### 기본값 (변경 전)
```python
legend=dict(
    orientation="v",  # 세로 방향
    yanchor="top",
    y=1,              # 차트 상단
    xanchor="right",
    x=1.02            # 차트 오른쪽 밖
)
```

#### 수정 후
```python
legend=dict(
    orientation="h",  # 가로 방향
    yanchor="top",
    y=-0.15,          # 차트 아래
    xanchor="center",
    x=0.5             # 중앙
)
```

### 좌표계 설명
```
차트 영역:
  y=1.0  ← 차트 상단
  y=0.5  ← 차트 중앙
  y=0.0  ← 차트 하단
  y=-0.15 ← 차트 아래 15% (범례 위치)

  x=0.0  ← 왼쪽
  x=0.5  ← 중앙
  x=1.0  ← 오른쪽
```

---

## 🎯 추가 개선 제안

### 향후 고려사항
1. **범례 스크롤**: 범례 항목이 많을 때 좌우 스크롤
2. **범례 토글**: 클릭으로 데이터 시리즈 표시/숨김 (이미 지원됨)
3. **범례 폰트 크기**: 모바일에서 자동 축소
4. **범례 줄바꿈**: 항목이 많을 때 2줄로 자동 배치

---

## 📊 Before & After 비교

### Desktop (1920px)
| 항목 | Before | After | 개선 |
|------|--------|-------|------|
| 차트 폭 | 1344px | 1920px | +43% |
| 범례 위치 | 오른쪽 | 아래 | ✅ |
| 가독성 | 보통 | 우수 | ✅ |

### Tablet (768px)
| 항목 | Before | After | 개선 |
|------|--------|-------|------|
| 차트 폭 | 537px | 768px | +43% |
| 범례 가독성 | 나쁨 | 우수 | ✅ |
| 막대 간격 | 좁음 | 충분 | ✅ |

### Mobile (375px)
| 항목 | Before | After | 개선 |
|------|--------|-------|------|
| 차트 폭 | 262px | 375px | +43% |
| 사용성 | 매우 나쁨 | 양호 | ✅ |
| 터치 영역 | 작음 | 적절 | ✅ |

---

## 🌟 사용자 경험 개선

### Before
- ❌ 좁은 화면에서 차트가 압축됨
- ❌ 범례가 공간을 많이 차지
- ❌ 모바일에서 가독성 저하
- ❌ 데이터 포인트가 겹침

### After
- ✅ 모든 화면에서 차트가 넓게 표시
- ✅ 범례가 효율적으로 배치
- ✅ 모바일 친화적
- ✅ 데이터가 명확하게 구분됨

---

**문서 버전**: 1.0  
**최종 업데이트**: 2026-02-06  
**작성자**: AI Assistant (Claude Sonnet 4.5)
