# 막대 차트 범례 개선 (날짜 포맷 + 위치 통일)

## 📅 업데이트 날짜
2026-02-06

## 🎯 개선 목적
1. 범례 날짜 포맷을 간결하게 변경 (4자리 연도 → 2자리 연도)
2. 요일별 검색량 추이 차트의 범례 위치를 다른 차트와 통일

---

## 📝 수정 사항

### 1. 날짜 포맷 변경 (모든 막대 차트)

#### Before
```
2025/10/01 ~ 2025/10/07
2025/10/08 ~ 2025/10/14
2025/10/15 ~ 2025/10/21
...
```
- 4자리 연도 (`YYYY`) 사용
- 범례 텍스트가 길어서 공간 차지

#### After
```
25/10/01 ~ 25/10/07
25/10/08 ~ 25/10/14
25/10/15 ~ 25/10/21
...
```
- 2자리 연도 (`YY`) 사용
- 범례 텍스트가 간결해짐
- 가독성 향상

---

### 2. 요일별 검색량 추이 범례 위치 통일

#### Before (문제)
```python
# 요일별 차트만 다른 설정
margin=dict(b=100),
legend=dict(y=-0.2)  # 너무 아래
```

#### After (통일)
```python
# 모든 차트와 동일한 설정
margin=dict(b=80),   # 표준 마진
legend=dict(y=-0.15) # 표준 위치
```

---

## 🔧 상세 수정 내역

### 파일: `visualizations.py`

#### 수정 1: `plot_daily_bar_chart()` (요일별 검색량 추이)

**라인 23-27**: 날짜 포맷 변경
```python
# Before
lambda x: f"{x['min'].strftime('%Y/%m/%d')} ~ {x['max'].strftime('%Y/%m/%d')}", axis=1

# After
lambda x: f"{x['min'].strftime('%y/%m/%d')} ~ {x['max'].strftime('%y/%m/%d')}", axis=1
```

**라인 36**: 툴팁 날짜 포맷 변경
```python
# Before
daily_counts['date_str'] = daily_counts['actual_date'].dt.strftime('%Y/%m/%d')

# After
daily_counts['date_str'] = daily_counts['actual_date'].dt.strftime('%y/%m/%d')
```

**라인 75-91**: 범례 위치 통일
```python
# Before
margin=dict(b=100),
legend=dict(
    orientation="h",
    yanchor="top",
    y=-0.2,  # 다른 차트와 다름
    xanchor="center",
    x=0.5
)

# After
margin=dict(b=80),  # 표준 마진
legend=dict(
    orientation="h",
    yanchor="top",
    y=-0.15,  # 다른 차트와 동일
    xanchor="center",
    x=0.5
)
```

---

#### 수정 2: `plot_keyword_group_trend()` (키워드별 추이 차트)

**라인 182-189**: 날짜 포맷 변경
```python
# Before
lambda x: f"{x['min'].strftime('%Y/%m/%d')}~{x['max'].strftime('%Y/%m/%d')}", axis=1

# After
lambda x: f"{x['min'].strftime('%y/%m/%d')}~{x['max'].strftime('%y/%m/%d')}", axis=1
```

**영향받는 차트** (4개):
- 인기 검색어: 1~5위 키워드별 검색량 추이
- 인기 검색어: 6~10위 키워드별 검색량 추이
- 실패 검색어: 1~5위 실패검색어 추이
- 실패 검색어: 6~10위 실패검색어 추이

---

## 📊 개선 효과

### 1. 날짜 포맷 간결화

#### 문자 수 감소
| 항목 | Before | After | 감소 |
|------|--------|-------|------|
| 단일 날짜 | 10자 (2025/10/01) | 8자 (25/10/01) | -20% |
| 범위 (공백 포함) | 25자 | 21자 | -16% |
| 범위 (공백 없음) | 23자 | 19자 | -17% |

#### 가독성 향상
- ✅ 범례가 차지하는 공간 감소
- ✅ 더 많은 주차 정보를 한 눈에 볼 수 있음
- ✅ 모바일에서 범례 텍스트가 잘리지 않음

---

### 2. 범례 위치 일관성

#### Before (불일치)
| 차트 | 마진 | 위치 | 문제 |
|------|------|------|------|
| 요일별 | b=100 | y=-0.2 | ❌ 너무 아래 |
| 키워드별 | b=80 | y=-0.15 | ✅ 적절 |

#### After (통일)
| 차트 | 마진 | 위치 | 상태 |
|------|------|------|------|
| 요일별 | b=80 | y=-0.15 | ✅ 통일 |
| 키워드별 | b=80 | y=-0.15 | ✅ 통일 |

---

## 🎨 UI 비교

### Desktop (1920px)

#### Before
```
┌──────────────────────────────────┐
│   요일별 검색량 추이               │
│   막대 차트 영역                  │
└──────────────────────────────────┘
              ↓ 너무 큰 간격
[2025/10/01 ~ 2025/10/07] [2025/10/08 ~ 2025/10/14]
```

#### After
```
┌──────────────────────────────────┐
│   요일별 검색량 추이               │
│   막대 차트 영역                  │
└──────────────────────────────────┘
          ↓ 적절한 간격
[25/10/01 ~ 25/10/07] [25/10/08 ~ 25/10/14] [25/10/15 ~ 25/10/21]
```

**개선**:
- ✅ 더 많은 주차 범례를 한 줄에 표시
- ✅ 간격이 일관되어 전체 UI 조화

---

### Mobile (375px)

#### Before
```
┌────────────────────┐
│  요일별 검색량 추이  │
│  막대 차트          │
└────────────────────┘
[2025/10/01 ~ 
 2025/10/07]         ← 줄바꿈 발생
```

#### After
```
┌────────────────────┐
│  요일별 검색량 추이  │
│  막대 차트          │
└────────────────────┘
[25/10/01 ~ 25/10/07] ← 한 줄에 표시
```

**개선**:
- ✅ 범례가 한 줄에 표시됨
- ✅ 줄바꿈으로 인한 레이아웃 깨짐 방지

---

## 📐 기술적 세부사항

### Python strftime 포맷 코드

| 코드 | 의미 | 예시 | 사용 |
|------|------|------|------|
| `%Y` | 4자리 연도 | 2025 | Before |
| `%y` | 2자리 연도 | 25 | After ✅ |
| `%m` | 월 (01-12) | 10 | 공통 |
| `%d` | 일 (01-31) | 27 | 공통 |

### 적용 위치

#### 함수 1: `plot_daily_bar_chart()`
```python
# Line 26: 범례 레이블
strftime('%y/%m/%d')  # 2자리 연도

# Line 36: 툴팁 표시
strftime('%y/%m/%d')  # 2자리 연도

# Line 83: 마진 설정
margin=dict(b=80)     # 80px

# Line 87: 범례 위치
y=-0.15               # 표준 위치
```

#### 함수 2: `plot_keyword_group_trend()`
```python
# Line 186: 범례 레이블
strftime('%y/%m/%d')  # 2자리 연도

# Line 248: 마진 설정 (기존 유지)
margin=dict(t=50, b=80, l=20, r=20)

# Line 252: 범례 위치 (기존 유지)
y=-0.15
```

---

## ✅ 적용된 차트 (5개)

### 주간 트렌드 탭
1. **요일별 검색량 추이**
   - ✅ 날짜 포맷: 4자리 → 2자리 연도
   - ✅ 범례 위치: y=-0.2 → y=-0.15 (통일)
   - ✅ 마진: b=100 → b=80 (통일)

### 인기 검색어 탭
2. **1~5위 키워드별 검색량 추이**
   - ✅ 날짜 포맷: 4자리 → 2자리 연도
   - 범례 위치: 변경 없음 (이미 표준)

3. **6~10위 키워드별 검색량 추이**
   - ✅ 날짜 포맷: 4자리 → 2자리 연도
   - 범례 위치: 변경 없음 (이미 표준)

### 실패 검색어 탭
4. **1~5위 실패검색어 추이**
   - ✅ 날짜 포맷: 4자리 → 2자리 연도
   - 범례 위치: 변경 없음 (이미 표준)

5. **6~10위 실패검색어 추이**
   - ✅ 날짜 포맷: 4자리 → 2자리 연도
   - 범례 위치: 변경 없음 (이미 표준)

---

## 🧪 테스트 가이드

### 1. 날짜 포맷 확인
```
1. 브라우저 새로고침 (F5)
2. 각 탭의 막대 차트 확인
3. 범례에서 날짜가 "25/10/01" 형식인지 확인
4. 툴팁(호버)에서도 "25/10/01" 형식인지 확인
```

### 2. 범례 위치 확인
```
1. 주간 트렌드 탭 → 요일별 검색량 추이
2. 인기 검색어 탭 → 키워드별 추이 차트
3. 두 차트의 범례 위치가 동일한지 비교
4. 차트와 범례 사이 간격이 일관된지 확인
```

### 3. 반응형 테스트
```
1. 개발자 도구 (F12) → 반응형 모드
2. 화면 폭 조절 (1920px → 768px → 375px)
3. 모든 크기에서 범례 텍스트가 한 줄에 표시되는지 확인
```

---

## 📁 수정된 파일

### `visualizations.py` (2개 함수, 5개 위치)

1. **`plot_daily_bar_chart()`**
   - Line 26: 날짜 포맷 변경 (%Y → %y)
   - Line 36: 툴팁 날짜 포맷 변경
   - Line 83: 마진 변경 (b=100 → b=80)
   - Line 87: 범례 위치 변경 (y=-0.2 → y=-0.15)

2. **`plot_keyword_group_trend()`**
   - Line 186: 날짜 포맷 변경 (%Y → %y)

---

## 🌟 사용자 경험 개선

### Before
- ⚠️ 날짜가 길어서 공간 차지
- ⚠️ 요일별 차트 범례가 너무 아래
- ⚠️ 차트마다 범례 위치가 다름
- ⚠️ 모바일에서 범례가 줄바꿈됨

### After
- ✅ 날짜가 간결해서 공간 효율적
- ✅ 모든 차트의 범례 위치가 통일
- ✅ 시각적 일관성 향상
- ✅ 모바일에서도 범례가 깔끔

---

## 💡 추가 개선 제안

### 향후 고려사항
1. **연도 생략 옵션**: 같은 연도 내에서는 연도 표시 생략
   - 예: `25/10/01 ~ 10/07` (같은 연도 내)
   - 예: `25/12/30 ~ 26/01/05` (연도 변경 시만 표시)

2. **범례 그룹핑**: 주차가 많을 때 "이전 주" / "최근 주" 그룹
   - 예: `[이전] 25/09/01 ~ 09/28`
   - 예: `[최근] 25/10/01 ~ 10/28`

3. **날짜 구분자 변경**: `/` 대신 `.` 또는 `-` 사용
   - 예: `25.10.01 ~ 25.10.07`
   - 예: `25-10-01 ~ 25-10-07`

---

## 🎯 결과

### 개선 요약
1. **날짜 포맷**: 4자리 연도 → 2자리 연도 (20% 간결화)
2. **범례 위치**: 모든 차트 통일 (일관성 향상)
3. **반응형**: 모바일 가독성 개선

### 영향
- ✅ 모든 막대 차트 (5개)
- ✅ 주간 트렌드, 인기 검색어, 실패 검색어 탭
- ✅ Desktop, Tablet, Mobile 모두 개선

---

**문서 버전**: 1.0  
**최종 업데이트**: 2026-02-06  
**작성자**: AI Assistant (Claude Sonnet 4.5)
